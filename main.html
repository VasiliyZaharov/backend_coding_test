<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Example</title>
</head>
<body>
    <h1>WebSocket Example</h1>
    <ul id="trade-history"></ul>

    <script>
        const tradeHistory = document.getElementById('trade-history');

        // Символы для валютных пар
        const symbols = ['btcusdt', 'btcrub', 'ethusdt', 'ethrub', 'trcrub', 'trcusdt', 'ercrub', 'ercusdt'];

        // Функция для создания WebSocket соединения для заданного символа
        function createWebSocket(symbol) {
            const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@trade`);
            
            ws.onopen = () => {
                console.log(`WebSocket connection opened for ${symbol}`);
            };
            
            ws.onmessage = (event) => {
                const tradeData = JSON.parse(event.data);
                console.log(`Received trade data for ${symbol}:`, tradeData);
                
                // Преобразуйте данные о сделке в нужный формат JSON
                const formattedData = {
                    exchanger: 'binance',
                    courses: [
                        {
                            direction: symbol.toUpperCase(),
                            value: parseFloat(tradeData.p).toFixed(6), // Округляем до 6 знаков после запятой
                        }
                    ]
                };
                
                // Преобразуйте JSON-ответ в форматированную строку
                const formattedString = JSON.stringify(formattedData, null, 2);
                
                // Добавьте новую сделку в начало списка
                const listItem = document.createElement('li');
                listItem.textContent = formattedString;
                tradeHistory.insertBefore(listItem, tradeHistory.firstChild);
            };
            
            ws.onclose = () => {
                console.log(`WebSocket connection closed for ${symbol}`);
            };
            
            ws.onerror = (error) => {
                console.error(`WebSocket error for ${symbol}:`, error);
            };
        }

        // Создайте WebSocket соединения для всех символов
        symbols.forEach(symbol => createWebSocket(symbol));
    </script>
</body>
</html>
